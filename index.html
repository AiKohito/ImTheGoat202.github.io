<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Passcode Authentication</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
    <style>
        /* Optional styles to improve appearance */
        #lockout-message {
            color: red;
        }
    </style>
</head>
<body>
    <div id="lockout-message" style="display:none;">You are locked out!</div>
    <form id="passcode-form">
        <input type="password" id="passcode" placeholder="Enter Passcode">
        <button type="button" id="submit-button">Submit</button>
    </form>
    <div id="content" style="display:none;">Welcome! This is protected content.</div>
    <div id="myTopnav" style="display:none;">Navigation Bar</div>

    <script>
        const maxAttempts = 3;
        const lockoutDuration = 30 * 60 * 1000; // 30 minutes in milliseconds

        async function authenticate() {
            const passcode = document.getElementById("passcode").value;
            const hashedPasscode = CryptoJS.MD5(passcode).toString();
            let attempts = parseInt(localStorage.getItem("attempts") || "0");
            let lockoutTime = parseInt(localStorage.getItem("lockoutTime") || "0");

            if (Date.now() < lockoutTime) {
                document.getElementById("lockout-message").style.display = "block";
                return;
            } else {
                document.getElementById("lockout-message").style.display = "none";
                localStorage.removeItem("lockoutTime");
            }

            const response = await fetch("https://raw.githubusercontent.com/MCRed2024/urlfetcher/main/fetcher.txt");
            const fullResponse = await response.text();

            if (hashedPasscode === fullResponse.trim()) {
                // Passcode is correct
                document.getElementById("content").style.display = "block";
                document.getElementById("myTopnav").style.display = "block";
                document.getElementById("passcode-form").style.display = "none";
                localStorage.removeItem("attempts");
                localStorage.setItem("enteredPasscode", passcode); // Store the entered passcode
            } else {
                // Incorrect passcode
                attempts++;
                localStorage.setItem("attempts", attempts);
                if (attempts >= maxAttempts) {
                    lockoutTime = Date.now() + lockoutDuration;
                    localStorage.setItem("lockoutTime", lockoutTime);
                    document.getElementById("lockout-message").style.display = "block";
                } else {
                    alert("Incorrect passcode. Please try again.");
                }
            }
        }

        async function checkPasscode() {
            const storedPasscode = localStorage.getItem("enteredPasscode");
            if (storedPasscode) {
                const hashedStoredPasscode = CryptoJS.MD5(storedPasscode).toString();
                const response = await fetch("https://raw.githubusercontent.com/MCRed2024/urlfetcher/main/fetcher.txt");
                const fullResponse = await response.text();
                if (hashedStoredPasscode === fullResponse.trim()) {
                    // Already authenticated
                    document.getElementById("content").style.display = "block";
                    document.getElementById("myTopnav").style.display = "block";
                    document.getElementById("passcode-form").style.display = "none";
                }
            }
        }

        window.onload = checkPasscode; // Check the passcode on page load
        document.getElementById("submit-button").addEventListener("click", authenticate); // Add event listener for submit button
    </script>
</body>
</html>
